---
description: Architecture phase - system design and technical planning
---

# 架构阶段 (Phase 4/9)

## 前置检查

读取 `.claude/PROJECT_STATE.json` 确认：
1. Gate 1 已通过
2. 当前阶段为 `architecture`

## 架构设计内容

### 🏗️ 1. 系统架构

```markdown
## 系统架构

### 架构风格
[单体/微服务/Serverless/混合]

### 架构图
[用 ASCII 或描述绘制架构图]

```
┌─────────────────────────────────────────────────┐
│                    前端                          │
│  ┌───────────┐  ┌───────────┐  ┌───────────┐   │
│  │  Web App  │  │ Mobile App│  │   Admin   │   │
│  └─────┬─────┘  └─────┬─────┘  └─────┬─────┘   │
└────────┼──────────────┼──────────────┼─────────┘
         │              │              │
         └──────────────┼──────────────┘
                        │
┌───────────────────────┼────────────────────────┐
│                   API Gateway                   │
└───────────────────────┼────────────────────────┘
                        │
┌───────────────────────┼────────────────────────┐
│                    后端服务                      │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐     │
│  │ 用户服务  │  │ 核心业务  │  │ 通知服务  │     │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘     │
└───────┼─────────────┼─────────────┼────────────┘
        │             │             │
┌───────┴─────────────┴─────────────┴────────────┐
│                    数据层                        │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐     │
│  │ PostgreSQL│  │  Redis   │  │   S3     │     │
│  └──────────┘  └──────────┘  └──────────┘     │
└────────────────────────────────────────────────┘
```

### 组件职责
| 组件 | 职责 | 技术选型 |
|------|------|----------|
| | | |
```

---

### ⚙️ 2. 技术栈确认

```markdown
## 技术栈

### 前端
| 类别 | 选择 | 版本 | 选择理由 |
|------|------|------|----------|
| 框架 | | | |
| 状态管理 | | | |
| UI组件库 | | | |
| 样式方案 | | | |
| 构建工具 | | | |

### 后端
| 类别 | 选择 | 版本 | 选择理由 |
|------|------|------|----------|
| Runtime | | | |
| 框架 | | | |
| ORM | | | |
| 认证 | | | |
| 缓存 | | | |

### 数据库
| 类型 | 选择 | 用途 |
|------|------|------|
| 主数据库 | | |
| 缓存 | | |
| 文件存储 | | |

### 基础设施
| 类别 | 选择 | 备注 |
|------|------|------|
| 部署平台 | | |
| CI/CD | | |
| 监控 | | |
| 日志 | | |
```

---

### 📡 3. API 设计

```markdown
## API 设计

### API 风格
[REST / GraphQL / gRPC]

### 认证方式
[JWT / Session / OAuth2]

### API 列表

#### 用户模块
| 方法 | 路径 | 描述 | 认证 |
|------|------|------|------|
| POST | /api/auth/register | 用户注册 | 无 |
| POST | /api/auth/login | 用户登录 | 无 |
| GET | /api/users/me | 获取当前用户 | 需要 |
| PUT | /api/users/me | 更新用户信息 | 需要 |

#### 核心业务模块
| 方法 | 路径 | 描述 | 认证 |
|------|------|------|------|
| | | | |

### API 响应格式
```json
{
  "success": true,
  "data": {},
  "error": null,
  "meta": {
    "timestamp": "",
    "requestId": ""
  }
}
```

### 错误码设计
| 错误码 | 含义 | HTTP状态码 |
|--------|------|------------|
| AUTH_001 | 未授权 | 401 |
| AUTH_002 | Token过期 | 401 |
| | | |
```

---

### 🗄️ 4. 数据模型

```markdown
## 数据模型

### ER 图
[描述实体关系]

### 数据表设计

#### users 表
| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | UUID | PK | 主键 |
| email | VARCHAR(255) | UNIQUE, NOT NULL | 邮箱 |
| password_hash | VARCHAR(255) | NOT NULL | 密码哈希 |
| created_at | TIMESTAMP | NOT NULL | 创建时间 |
| updated_at | TIMESTAMP | NOT NULL | 更新时间 |

#### [其他表]
| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| | | | |

### 索引设计
| 表 | 索引名 | 字段 | 类型 |
|----|--------|------|------|
| users | idx_users_email | email | UNIQUE |
| | | | |
```

---

### 📁 5. 项目结构

```markdown
## 项目结构

```
project/
├── apps/
│   ├── web/                 # 前端应用
│   │   ├── src/
│   │   │   ├── components/  # UI组件
│   │   │   ├── pages/       # 页面
│   │   │   ├── hooks/       # 自定义Hooks
│   │   │   ├── stores/      # 状态管理
│   │   │   ├── services/    # API调用
│   │   │   └── utils/       # 工具函数
│   │   └── package.json
│   │
│   └── api/                 # 后端应用
│       ├── src/
│       │   ├── modules/     # 业务模块
│       │   ├── common/      # 公共模块
│       │   ├── config/      # 配置
│       │   └── main.ts      # 入口
│       └── package.json
│
├── packages/                # 共享包
│   └── shared/              # 共享类型/工具
│
├── docs/                    # 文档
├── scripts/                 # 脚本
└── docker-compose.yml       # 本地开发环境
```
```

---

## 输出产物

生成以下文件：
1. `docs/ARCHITECTURE.md` - 架构设计文档
2. `docs/API.md` - API 设计文档
3. `docs/DATABASE.md` - 数据库设计文档

---

## 阶段完成

更新 `PROJECT_STATE.json`:
```json
{
  "phases": {
    "architecture": { "status": "completed", "completedAt": "[timestamp]" },
    "prototype": { "status": "in_progress", "completedAt": null }
  },
  "currentPhase": 5
}
```

输出：
```
✅ 架构阶段完成！

已生成：
📄 docs/ARCHITECTURE.md - 架构设计文档
📄 docs/API.md - API 设计文档
📄 docs/DATABASE.md - 数据库设计文档

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✓ 研究 → ✓ 规划 → ✓ Gate1 → ✓ 架构 → 🎨 原型 → ✅ Gate2 → ⚙️ 后端 → 🔗 集成 → 📦 输出
                                     ↑
                                   下一步
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

下一步：运行 /project-optimizer:prototype 进入原型阶段
```
