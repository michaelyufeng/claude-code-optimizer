---
description: Auto-pilot mode - one command to drive the entire project
---

# 自动驾驶模式 (Auto-Pilot)

一次启动，全程跟踪项目直到完成。

## 启动命令

```bash
/project-optimizer:start [项目描述]
/project-optimizer:start --resume    # 恢复已有项目
```

## 核心机制

### 1. 全自动 4 阶段流程

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│  研究    │───▶│  规划    │───▶│  架构    │───▶│  开发    │
│ Research │    │   Plan   │    │   Arch   │    │   Dev    │
└────┬─────┘    └────┬─────┘    └────┬─────┘    └────┬─────┘
     │               │               │               │
     ▼               ▼               ▼               ▼
  [Gate 1]       [Gate 2]       [Gate 3]       [完成]
```

### 2. 选项驱动（禁止无方向编码）

每个决策点都会提供选项，Claude 不会无方向地编写代码。

### 3. 自动 Agent 分配

根据任务类型自动分配最合适的 Agent 和模型。

### 4. 双记忆系统

- 短期记忆：Memory 区域（最近 10 条）
- 长期记忆：History 文件（永久保存）

---

## 启动流程

### Step 1: 项目初始化

```
🚀 自动驾驶模式启动

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 项目信息收集

项目名称: $ARGUMENTS 或询问用户
项目类型: [自动检测或询问]

请选择项目类型:
[1] 🌐 Web 应用 (前端/全栈)
[2] 🔧 API 服务 (后端)
[3] 📱 移动应用
[4] 🛠️ CLI 工具
[5] 📦 库/SDK
[6] 🤖 其他

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### Step 2: 创建项目状态

创建 `.claude/PROJECT_STATE.json`:

```json
{
  "project": {
    "name": "[项目名称]",
    "type": "[项目类型]",
    "description": "[项目描述]",
    "createdAt": "[timestamp]"
  },
  "autopilot": {
    "enabled": true,
    "startedAt": "[timestamp]",
    "currentPhase": "research",
    "phaseProgress": 0
  },
  "phases": {
    "research": { "status": "in_progress", "gate": null },
    "plan": { "status": "pending", "gate": null },
    "arch": { "status": "pending", "gate": null },
    "dev": { "status": "pending", "gate": null }
  },
  "memory": {
    "shortTerm": [],
    "lastReflect": null
  },
  "tasks": {
    "current": null,
    "queue": [],
    "completed": []
  },
  "agents": {
    "active": "analyst",
    "history": []
  }
}
```

### Step 3: 自动进入研究阶段

```
✅ 项目初始化完成！

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🚗 自动驾驶已启动

当前阶段: 🔬 研究阶段 (1/4)
当前 Agent: 🔬 分析师

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🔬 [分析师] 开始研究...

我将分析以下内容:
1. 项目需求和目标用户
2. 技术可行性
3. 类似项目/竞品
4. 推荐技术方案

请描述你的项目需求，或选择:
[1] 📝 详细描述需求
[2] 📎 上传需求文档
[3] 🔍 让我分析现有代码

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 自动驾驶行为规则

### 阶段自动推进

```markdown
## 自动推进条件

1. 当前阶段完成所有必要任务
2. Gate 检查通过
3. 用户确认（关键节点）

## 自动推进流程

阶段完成 → Gate 检查 → 通过 → 自动进入下一阶段
                      → 失败 → 显示问题 → 修复后重试
```

### Agent 自动切换

```markdown
## Agent 自动分配

| 阶段 | 主要 Agent | 辅助 Agent |
|------|-----------|-----------|
| 研究 | 🔬 分析师 | - |
| 规划 | 📋 PM | 🔬 分析师 |
| 架构 | 🏗️ 架构师 | 📋 PM |
| 开发 | 💻 开发者 | 👁️ 审核员 |

## 任务级别 Agent

| 任务类型 | Agent | 模型 |
|----------|-------|------|
| 简单实现 | 💻 开发者 | Haiku |
| 复杂逻辑 | 💻 开发者 | Sonnet |
| 架构决策 | 🏗️ 架构师 | Opus |
| 代码审查 | 👁️ 审核员 | Sonnet |
```

### 任务自动分割

```markdown
## 大任务自动分割

检测条件:
- 预估代码 > 200 行
- 涉及文件 > 3 个
- 有多个独立子功能

分割后:
- 自动创建子任务
- 分配给合适的 Agent
- 可并行的任务同时执行
```

---

## 全程同步机制

### CLAUDE.md 自动更新

```markdown
## 同步触发点

1. 阶段完成时
   → 自动更新项目状态
   → 添加阶段产出摘要

2. 重要决策时
   → 记录到 Memory
   → 更新规则（如有）

3. 代码变更时
   → 检测结构变化
   → 更新技术栈信息

4. Git commit 时
   → 自动归档短期记忆
   → 更新变更历史
```

### 双记忆自动管理

```markdown
## 短期记忆 (Memory)

- 自动记录关键决策
- 最多保留 10 条
- 超出时自动 reflect 到长期记忆

## 长期记忆 (History)

- reflect 命令整理
- 永久保存在 docs/HISTORY.md
- 按时间和主题组织
```

---

## 输出格式

### 阶段进度显示

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🚗 自动驾驶状态
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

进度: ████████░░░░░░░░░░░░ 40%

[✅ 研究] → [✅ 规划] → [🔄 架构] → [⬜ 开发]
                           ↑
                        当前阶段

当前任务: 设计 API 接口
当前 Agent: 🏗️ 架构师
下一步: 完成 API 设计后进入 Gate 3

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 选项提示格式

```
📋 [阶段名] 需要决策

[问题描述]

请选择:
[1] [选项1] (推荐) - [说明]
[2] [选项2] - [说明]
[3] [选项3] - [说明]
[4] 🔍 需要更多信息

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 恢复模式

```bash
/project-optimizer:start --resume
```

```
🔄 恢复自动驾驶模式

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 检测到项目状态

项目: [项目名称]
上次活动: [时间]
当前阶段: [阶段]
进度: [百分比]

最近记忆:
- [记忆1]
- [记忆2]
- [记忆3]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[1] ▶️ 继续当前任务
[2] 📋 查看完整状态
[3] 🔄 重新开始当前阶段
[4] ⏭️ 跳到下一阶段（需确认）
```

---

## 注意事项

1. **不可跳过阶段** - 必须按顺序完成 4 个阶段
2. **不可跳过 Gate** - 每个阶段必须通过门控检查
3. **禁止无方向编码** - 所有编码必须有明确的任务来源
4. **强制选项驱动** - 关键决策必须由用户选择
5. **自动同步** - CLAUDE.md 和项目状态实时同步
