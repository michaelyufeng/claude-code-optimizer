---
description: Short-term memory - capture session info to CLAUDE.md Memory section
---

# 短期记忆 (Diary)

记录会话关键信息到 CLAUDE.md 的 Memory 区域。

## 自动驾驶行为

自动驾驶模式下，diary 会在以下时机自动触发：

- 重要决策后
- 阶段完成后
- 每个功能完成后
- 遇到关键问题时

---

## Memory 区域格式

```markdown
## Memory

### 2024-12-23 15:30 - [简短标题]
- **完成**: [完成的任务]
- **决策**: [重要决策及原因]
- **发现**: [新发现的信息]
- **待办**: [下一步任务]

### 2024-12-23 14:00 - [简短标题]
...
```

---

## 自动记录内容

### 阶段完成记录

```markdown
### [日期时间] - 研究阶段完成
- **完成**: 需求分析、技术选型、竞品研究
- **决策**: 选择 TypeScript + Hono，原因: 类型安全、性能好
- **发现**: 现有方案都没有很好的错误处理
- **待办**: 进入规划阶段，编写 PRD
```

### 功能完成记录

```markdown
### [日期时间] - 用户注册功能完成
- **完成**: 注册 API、密码加密、邮箱验证
- **决策**: 使用 bcrypt 而非 argon2，原因: 兼容性更好
- **发现**: 需要添加注册限流
- **待办**: 实现登录功能
```

### 问题记录

```markdown
### [日期时间] - 发现数据库性能问题
- **完成**: 定位到 N+1 查询问题
- **决策**: 使用 eager loading 解决
- **发现**: 需要添加数据库索引
- **待办**: 优化查询、添加索引
```

---

## 容量管理

### 最多保留 10 条

```markdown
## Memory 容量规则

- 最多保留 10 条记录
- 超出时自动触发 /reflect
- 旧记录整理到长期记忆
```

### 自动触发 reflect

```
📝 Memory 容量已满 (10/10)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

正在整理短期记忆到长期记忆...

将归档:
- 3 条研究阶段记录
- 2 条规划阶段记录

保留:
- 5 条最新记录

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

归档完成！查看长期记忆: docs/HISTORY.md
```

---

## 手动命令

```bash
/project-optimizer:diary                    # 自动分析并记录
/project-optimizer:diary "完成了XX功能"      # 指定记录内容
/project-optimizer:diary --show             # 查看当前 Memory
/project-optimizer:diary --clear            # 清空 Memory (归档后)
```

### 手动记录示例

```
/project-optimizer:diary "决定使用 JWT 认证"

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📝 已记录到 Memory

### 2024-12-23 16:00 - 决定使用 JWT 认证
- **完成**: 认证方案选型
- **决策**: 使用 JWT 认证
- **待办**: 实现 JWT 中间件

Memory: 7/10 条

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 查看 Memory

```
/project-optimizer:diary --show

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📝 当前 Memory (7/10)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

### 2024-12-23 16:00 - 决定使用 JWT 认证
- **决策**: 使用 JWT 认证

### 2024-12-23 15:30 - 架构阶段完成
- **完成**: API 设计、数据模型
- **产出**: docs/ARCHITECTURE.md

### 2024-12-23 14:00 - 规划阶段完成
- **完成**: PRD 编写、优先级排序
- **产出**: docs/PRD.md

... (更多记录)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[1] 📖 查看完整内容
[2] 🔄 整理到长期记忆
[3] ❌ 删除指定记录
```

---

## 与同步系统集成

diary 记录会自动同步到 CLAUDE.md，确保：

- 新会话可以看到之前的记忆
- Git commit 时记忆被保存
- 跨会话记忆不丢失
