---
description: Approval gate for production fixes (mandatory review)
---

# 修复审批 (运维项目 - Phase 2/5)

## 前置检查

确认诊断阶段 (`diagnose`) 已完成。

## ⚠️ 审批必要性

```
🔴 运维模式 - 强制审批

生产环境的任何修改都必须经过审批。
这是一个不可跳过的检查点。

审批目的：
1. 确保修复方案正确
2. 评估修复风险
3. 确认回滚方案
4. 记录变更历史
```

## 审批流程

### 📋 1. 审批表单

```markdown
## 变更审批单

### 基本信息
- 变更编号: CHG-[YYYYMMDD]-[序号]
- 申请时间: [timestamp]
- 申请人: [name]
- 紧急程度: [P0/P1/P2/P3]

### 问题信息
- 问题描述: [简述]
- 根本原因: [简述]
- 影响范围: [描述]

### 变更内容
| 文件 | 变更类型 | 变更行数 | 变更描述 |
|------|----------|----------|----------|
| | | | |

### 风险评估
- 风险等级: 低/中/高
- 风险描述: [描述]
- 缓解措施: [措施]

### 回滚方案
[详细的回滚步骤]

### 验证方案
[如何验证修复成功]

### 变更窗口
- 计划执行时间: [时间]
- 预计完成时间: [时间]
- 监控时长: [时长]
```

### ✅ 2. 审批检查项

```markdown
## 审批检查清单

### 技术检查
- [ ] 修复方案与根因匹配
- [ ] 修改范围最小化
- [ ] 不引入新风险
- [ ] 不影响其他功能
- [ ] 有完整回滚方案

### 流程检查
- [ ] 诊断报告完整
- [ ] 变更描述清晰
- [ ] 验证步骤明确
- [ ] 监控方案就绪

### 风险检查
- [ ] 风险评估合理
- [ ] 缓解措施充分
- [ ] 紧急程度正确
- [ ] 变更窗口合适
```

### 👆 3. 用户确认

```markdown
## 请确认以下信息

📋 变更摘要：
- 修改文件: [X] 个
- 修改行数: [~X] 行
- 风险等级: [低/中/高]

🛠️ 修改内容：
[修改内容摘要]

⚠️ 风险提示：
[风险说明]

🔄 回滚方案：
[回滚方案摘要]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
确认审批通过？

输入 "approve" 批准修复
输入 "reject" 拒绝并返回诊断
输入 "modify" 修改方案
```

---

## 审批结果

### 审批通过

```json
{
  "phases": {
    "approve": {
      "status": "completed",
      "completedAt": "[timestamp]",
      "result": "approved",
      "approver": "[user]",
      "changeId": "CHG-XXXXXXXX-XX"
    },
    "fix": { "status": "in_progress" }
  }
}
```

输出：
```
✅ 审批通过！

📋 变更编号: CHG-XXXXXXXX-XX
⏰ 审批时间: [timestamp]
👤 审批人: [user]

⚠️ 重要提醒：
- 请按照修复方案执行
- 执行前确认回滚方案
- 执行后进行验证
- 监控系统状态

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🚀 运维项目流程:
✓ 诊断 → ✓ 审批 → 🔧 修复 → ✔️ 验证 → 📦 输出
                     ↑
                   下一步
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

下一步：运行 /project-optimizer:fix 执行修复
```

### 审批拒绝

```json
{
  "phases": {
    "approve": {
      "status": "rejected",
      "rejectedAt": "[timestamp]",
      "reason": "[拒绝原因]"
    },
    "diagnose": { "status": "in_progress" }
  }
}
```

输出：
```
❌ 审批未通过

原因: [拒绝原因]

建议:
- [改进建议1]
- [改进建议2]

请运行 /project-optimizer:diagnose 重新诊断
```
