---
description: Auto-detect code changes and sync with task tracking
---

# è‡ªåŠ¨æ£€æµ‹ (Auto-Detect)

æ£€æµ‹ç”¨æˆ·æ‰‹åŠ¨ä»£ç å˜æ›´ï¼Œè‡ªåŠ¨åŒæ­¥åˆ°ä»»åŠ¡è¿½è¸ªç³»ç»Ÿã€‚

**æ ¸å¿ƒç›®æ ‡**: å³ä½¿ç”¨æˆ·ç»•è¿‡å·¥ä½œæµæ‰‹åŠ¨ä¿®æ”¹ä»£ç ï¼ŒClaude ä¹Ÿèƒ½æ„ŸçŸ¥å¹¶åŒæ­¥çŠ¶æ€ã€‚

---

## è§¦å‘æ—¶æœº

### è‡ªåŠ¨è§¦å‘

| æ—¶æœº | æ£€æµ‹å†…å®¹ | æ“ä½œ |
|------|----------|------|
| `/start --resume` | Git diff + æ–‡ä»¶å˜æ›´ | æç¤ºåŒæ­¥é€‰é¡¹ |
| `/status` | å¿«é€Ÿæ£€æµ‹æœªè¿½è¸ªå˜æ›´ | æ˜¾ç¤ºè­¦å‘Š |
| `/dev` å¼€å§‹å‰ | æ£€æµ‹å†²çªå˜æ›´ | ç¡®è®¤åç»§ç»­ |
| ä»»æ„å‘½ä»¤å¼€å§‹æ—¶ | æ£€æµ‹ TASKS.md æ˜¯å¦è¿‡æœŸ | è‡ªåŠ¨åˆ·æ–° |

### æ‰‹åŠ¨è§¦å‘

```bash
/project-optimizer:detect              # å®Œæ•´æ£€æµ‹
/project-optimizer:detect --quick      # å¿«é€Ÿæ£€æµ‹
/project-optimizer:detect --sync       # æ£€æµ‹å¹¶è‡ªåŠ¨åŒæ­¥
```

---

## æ£€æµ‹æœºåˆ¶

### Step 1: è¯»å–ä¸Šæ¬¡åŒæ­¥ç‚¹

è¯»å– `.claude/LAST_SYNC.json`:

```json
{
  "lastSyncAt": "2024-12-23T16:00:00Z",
  "lastCommit": "abc1234",
  "trackedFiles": [
    "src/auth/login.ts",
    "src/auth/register.ts",
    "src/db/schema.ts"
  ],
  "taskSnapshot": {
    "completed": ["I1", "I2", "F1"],
    "inProgress": ["F2"],
    "pending": ["F3", "F4"]
  }
}
```

### Step 2: æ£€æµ‹å˜æ›´

```bash
# æ£€æµ‹è‡ªä¸Šæ¬¡åŒæ­¥åçš„å˜æ›´
git diff --name-only [lastCommit]..HEAD
git status --porcelain
```

### Step 3: åˆ†æå˜æ›´ç±»å‹

```
ğŸ” æ£€æµ‹åˆ°å˜æ›´

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## å·²è¿½è¸ªä»»åŠ¡ç›¸å…³å˜æ›´

| æ–‡ä»¶ | å˜æ›´ç±»å‹ | å…³è”ä»»åŠ¡ | çŠ¶æ€ |
|------|----------|----------|------|
| src/auth/login.ts | ä¿®æ”¹ | F2 | âš ï¸ ä»»åŠ¡è¿›è¡Œä¸­ |
| src/auth/register.ts | ä¿®æ”¹ | F1 | âš ï¸ ä»»åŠ¡å·²å®Œæˆ |

## æœªè¿½è¸ªå˜æ›´ (ç”¨æˆ·æ‰‹åŠ¨ä¿®æ”¹)

| æ–‡ä»¶ | å˜æ›´ç±»å‹ | å»ºè®® |
|------|----------|------|
| src/utils/helper.ts | æ–°å¢ | åˆ›å»ºæ–°ä»»åŠ¡? |
| src/config.ts | ä¿®æ”¹ | å…³è”åˆ°ç°æœ‰ä»»åŠ¡? |

## Git çŠ¶æ€

æœªæäº¤å˜æ›´: 3 ä¸ªæ–‡ä»¶
æœªè¿½è¸ªæ–‡ä»¶: 1 ä¸ª

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ£€æµ‹åˆ° 2 ä¸ªæœªè¿½è¸ªçš„å˜æ›´ï¼Œéœ€è¦åŒæ­¥å—ï¼Ÿ

[1] ğŸ”„ è‡ªåŠ¨åŒæ­¥åˆ°ä»»åŠ¡ç³»ç»Ÿ
[2] â• åˆ›å»ºæ–°ä»»åŠ¡æ¥è¿½è¸ª
[3] ğŸ”— å…³è”åˆ°ç°æœ‰ä»»åŠ¡
[4] â­ï¸ è·³è¿‡ (è®°å½•ä½†ä¸å¤„ç†)
[5] âŒ å¿½ç•¥è¿™äº›å˜æ›´
```

---

## åŒæ­¥ç­–ç•¥

### ç­–ç•¥ 1: è‡ªåŠ¨åŒæ­¥

å°†å˜æ›´è‡ªåŠ¨å…³è”åˆ°æœ€ç›¸å…³çš„ä»»åŠ¡ï¼š

```
ğŸ”„ è‡ªåŠ¨åŒæ­¥ä¸­...

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## åŒæ­¥ç»“æœ

âœ… src/auth/login.ts â†’ å…³è”åˆ° F2 (ç”¨æˆ·ç™»å½•)
âœ… src/auth/register.ts â†’ æ›´æ–° F1 å¤‡æ³¨
âœ… src/utils/helper.ts â†’ åˆ›å»ºä»»åŠ¡ U1 (å·¥å…·å‡½æ•°)
âœ… src/config.ts â†’ å…³è”åˆ° I1 (é¡¹ç›®é…ç½®)

## æ›´æ–° TASKS.md

### è¿›è¡Œä¸­

| ID | ä»»åŠ¡ | Agent | å¼€å§‹æ—¶é—´ | å¤‡æ³¨ |
|----|------|-------|----------|------|
| F2 | ç”¨æˆ·ç™»å½• | ğŸ’» å¼€å‘è€… | 14:00 | +ç”¨æˆ·æ‰‹åŠ¨ä¿®æ”¹ |

### å¾…å¤„ç†

| ID | ä»»åŠ¡ | ä¼˜å…ˆçº§ | ä¾èµ– | é¢„ä¼°è§„æ¨¡ |
|----|------|--------|------|----------|
| U1 | å·¥å…·å‡½æ•° (ç”¨æˆ·æ·»åŠ ) | P2 | - | S |

## ä¼šè¯æ—¥å¿—

- **16:30** - ğŸ” æ£€æµ‹åˆ°ç”¨æˆ·æ‰‹åŠ¨å˜æ›´ï¼Œå·²åŒæ­¥ 4 ä¸ªæ–‡ä»¶

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

åŒæ­¥å®Œæˆï¼ç»§ç»­å·¥ä½œ...
```

### ç­–ç•¥ 2: åˆ›å»ºæ–°ä»»åŠ¡

ä¸ºç”¨æˆ·æ‰‹åŠ¨ä¿®æ”¹åˆ›å»ºç‹¬ç«‹ä»»åŠ¡ï¼š

```
â• åˆ›å»ºä»»åŠ¡

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä¸ºä»¥ä¸‹å˜æ›´åˆ›å»ºä»»åŠ¡:

æ–‡ä»¶: src/utils/helper.ts, src/config.ts

è¯·è¾“å…¥ä»»åŠ¡æè¿° (æˆ–å›è½¦ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆ):
> æ·»åŠ å·¥å…·å‡½æ•°å’Œé…ç½®ä¼˜åŒ–

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… å·²åˆ›å»ºä»»åŠ¡:

| ID | ä»»åŠ¡ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|----|------|--------|------|
| U1 | æ·»åŠ å·¥å…·å‡½æ•°å’Œé…ç½®ä¼˜åŒ– | P2 | âœ… å·²å®Œæˆ |

å·²æ›´æ–° TASKS.md
```

### ç­–ç•¥ 3: å…³è”ç°æœ‰ä»»åŠ¡

```
ğŸ”— å…³è”ä»»åŠ¡

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

é€‰æ‹©è¦å…³è”çš„ä»»åŠ¡:

[1] F2 - ç”¨æˆ·ç™»å½• (è¿›è¡Œä¸­)
[2] F3 - æ ¸å¿ƒåŠŸèƒ½ (å¾…å¤„ç†)
[3] I1 - é¡¹ç›®åˆå§‹åŒ– (å·²å®Œæˆ)

è¯·é€‰æ‹©: 1

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… å·²å…³è”åˆ° F2

æ›´æ–° TASKS.md:
- F2 å¤‡æ³¨: +ç”¨æˆ·æ‰‹åŠ¨ä¿®æ”¹ helper.ts, config.ts
```

---

## æ¢å¤ä¼šè¯æ—¶çš„æ£€æµ‹

å½“ç”¨æˆ·ä½¿ç”¨ `/start --resume` æ—¶ï¼š

```
ğŸ”„ æ¢å¤è‡ªåŠ¨é©¾é©¶æ¨¡å¼

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ é¡¹ç›®çŠ¶æ€

é¡¹ç›®: [é¡¹ç›®åç§°]
ä¸Šæ¬¡æ´»åŠ¨: 2 å°æ—¶å‰
å½“å‰é˜¶æ®µ: å¼€å‘ (60%)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ” æ£€æµ‹åˆ°ç¦»çº¿å˜æ›´ï¼

ä¸Šæ¬¡åŒæ­¥åå‘ç”Ÿçš„å˜æ›´:

| æ–‡ä»¶ | å˜æ›´ | æ—¶é—´ |
|------|------|------|
| src/auth/login.ts | ä¿®æ”¹ | 1 å°æ—¶å‰ |
| src/utils/new.ts | æ–°å¢ | 30 åˆ†é’Ÿå‰ |
| package.json | ä¿®æ”¹ | 30 åˆ†é’Ÿå‰ |

è¿™äº›å˜æ›´æœªè¢«ä»»åŠ¡è¿½è¸ªç³»ç»Ÿè®°å½•ã€‚

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[1] ğŸ”„ åŒæ­¥å˜æ›´åˆ°ä»»åŠ¡ç³»ç»Ÿ (æ¨è)
[2] ğŸ“‹ æŸ¥çœ‹å˜æ›´è¯¦æƒ…
[3] â­ï¸ è·³è¿‡åŒæ­¥ï¼Œç»§ç»­å·¥ä½œ
[4] ğŸ”™ æ’¤é”€è¿™äº›å˜æ›´
```

---

## LAST_SYNC.json æ›´æ–°

æ¯æ¬¡åŒæ­¥åæ›´æ–°ï¼š

```json
{
  "lastSyncAt": "2024-12-23T16:30:00Z",
  "lastCommit": "def5678",
  "trackedFiles": [
    "src/auth/login.ts",
    "src/auth/register.ts",
    "src/utils/helper.ts",
    "src/config.ts"
  ],
  "taskSnapshot": {
    "completed": ["I1", "I2", "F1", "U1"],
    "inProgress": ["F2"],
    "pending": ["F3", "F4"]
  },
  "userChanges": [
    {
      "files": ["src/utils/helper.ts", "src/config.ts"],
      "syncedAt": "2024-12-23T16:30:00Z",
      "action": "created_task",
      "taskId": "U1"
    }
  ]
}
```

---

## ä¸å…¶ä»–å‘½ä»¤é›†æˆ

### /start --resume

```markdown
æ¢å¤æ—¶è‡ªåŠ¨æ‰§è¡Œ:
1. è¯»å– PROJECT_STATE.json
2. è¯»å– LAST_SYNC.json
3. æ‰§è¡Œ git diff æ£€æµ‹
4. å¦‚æœ‰å˜æ›´ â†’ æ˜¾ç¤ºåŒæ­¥é€‰é¡¹
5. åŒæ­¥å®Œæˆ â†’ ç»§ç»­å·¥ä½œ
```

### /status

```markdown
çŠ¶æ€æ˜¾ç¤ºæ—¶:
1. å¿«é€Ÿæ£€æµ‹æœªæäº¤å˜æ›´
2. å¦‚æœ‰æœªè¿½è¸ªå˜æ›´ â†’ æ˜¾ç¤ºè­¦å‘Š
3. æç¤ºä½¿ç”¨ /detect åŒæ­¥
```

### /dev

```markdown
å¼€å§‹ä»»åŠ¡å‰:
1. æ£€æµ‹å½“å‰ä»»åŠ¡ç›¸å…³æ–‡ä»¶æ˜¯å¦è¢«ä¿®æ”¹
2. å¦‚æœ‰å†²çª â†’ æç¤ºç¡®è®¤
3. ç”¨æˆ·ç¡®è®¤åç»§ç»­
```

---

## é…ç½®

`.claude/detect-config.json`:

```json
{
  "autoDetect": {
    "enabled": true,
    "onResume": true,
    "onStatus": true,
    "beforeTask": true
  },
  "ignore": [
    "node_modules/**",
    "dist/**",
    "*.log",
    ".env*"
  ],
  "autoSync": {
    "enabled": false,
    "threshold": 3
  },
  "notifications": {
    "showWarning": true,
    "requireConfirmation": true
  }
}
```

---

## æ³¨æ„äº‹é¡¹

1. **ä¸å¼ºåˆ¶åŒæ­¥** - å§‹ç»ˆç»™ç”¨æˆ·é€‰æ‹©æƒ
2. **ä¿ç•™å˜æ›´å†å²** - è®°å½•æ‰€æœ‰ç”¨æˆ·æ‰‹åŠ¨ä¿®æ”¹
3. **æ™ºèƒ½å…³è”** - æ ¹æ®æ–‡ä»¶è·¯å¾„æ¨æ–­ç›¸å…³ä»»åŠ¡
4. **å†²çªå¤„ç†** - å·²å®Œæˆä»»åŠ¡è¢«ä¿®æ”¹æ—¶ç‰¹åˆ«æç¤º
5. **æ€§èƒ½ä¼˜å…ˆ** - å¿«é€Ÿæ£€æµ‹ï¼Œä¸é˜»å¡å·¥ä½œæµ
