---
description: Initialize project for Claude Code optimization
---

# Initialize Project

初始化项目，智能处理现有配置。

## 执行流程

### 第一步：检测现有配置

```bash
# 检查是否存在 CLAUDE.md
if [ -f "./CLAUDE.md" ]; then
    # 存在 → 进入评估流程
else
    # 不存在 → 进入创建流程
fi
```

---

## 场景 A：项目没有 CLAUDE.md

### 询问项目类型

```
🎯 请选择项目状态：

[1] 🆕 全新项目 - 从零开始，完整规划流程
[2] 🔧 开发中项目 - 已有代码，适度限制
[3] 🚀 生产项目 - 线上运行，严格红线
```

### 创建配置

根据项目类型创建 CLAUDE.md（使用 templates/ 中的模板）

---

## 场景 B：项目已有 CLAUDE.md

### 第一步：质量评估

读取现有 CLAUDE.md，按以下维度评分（1-10分）：

#### 评估维度

| 维度 | 权重 | 检查项 |
|------|------|--------|
| 📋 完整性 | 25% | 是否包含：项目概述、技术栈、代码规范、工作流程、命令说明 |
| ✂️ 简洁性 | 20% | 行数是否在 100-200 行之间，无冗余内容 |
| 🎯 实用性 | 25% | 命令是否清晰、规范是否可执行、约束是否明确 |
| 📐 规范性 | 15% | 是否有版本号、更新时间、作者信息、结构清晰 |
| 🔄 演进性 | 15% | 是否有状态追踪、是否支持持续更新 |

#### 评分标准

```markdown
## 完整性检查 (25%)

必须包含：
- [ ] 项目概述/简介 (+2)
- [ ] 技术栈说明 (+2)
- [ ] 代码规范/风格 (+2)
- [ ] 命令/脚本说明 (+2)
- [ ] 目录结构 (+2)

## 简洁性检查 (20%)

- 50-100 行: +10
- 100-200 行: +8
- 200-300 行: +5
- 300+ 行: +2 (过长，需精简)
- <50 行: +3 (过短，可能不完整)

## 实用性检查 (25%)

- [ ] 有可直接使用的命令 (+3)
- [ ] 规范具体可执行 (+3)
- [ ] 约束明确（有 MUST/SHOULD/PREFER 分级）(+2)
- [ ] 有示例代码或模板 (+2)

## 规范性检查 (15%)

- [ ] 有版本号或更新时间 (+3)
- [ ] 结构使用标准 Markdown 标题 (+3)
- [ ] 有作者/团队信息 (+2)
- [ ] 格式统一美观 (+2)

## 演进性检查 (15%)

- [ ] 有项目状态/阶段说明 (+4)
- [ ] 有变更历史或 changelog (+3)
- [ ] 支持持续更新的结构 (+3)
```

### 第二步：输出评估结果

```
📊 CLAUDE.md 质量评估

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📁 文件信息：
   路径: ./CLAUDE.md
   行数: 156 行
   最后修改: 2024-12-20

📈 质量评分：

   完整性  ████████░░  80% (8/10)
           ✓ 项目概述  ✓ 技术栈  ✓ 代码规范
           ✗ 缺少目录结构说明

   简洁性  ███████░░░  70% (7/10)
           156 行，在合理范围内
           ⚠ 代码规范章节可精简 (60行→30行)

   实用性  █████████░  90% (9/10)
           ✓ 命令清晰  ✓ 规范可执行
           ✓ 有规则分级

   规范性  ██████░░░░  60% (6/10)
           ✗ 无版本号  ✗ 无更新时间
           ✓ 结构清晰

   演进性  ████░░░░░░  40% (4/10)
           ✗ 无状态追踪  ✗ 无变更历史
           ⚠ 结构不支持持续更新

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📊 综合评分: 72/100

🏷️ 评级: ⭐⭐⭐ 良好 (可优化)
```

### 第三步：根据评分决定处理方式

#### 评分 >= 80：认证模式

```
✅ CLAUDE.md 质量良好！

建议操作：
[1] ✅ 认证通过 - 添加审查标签，记录已评估
[2] 🔧 小幅优化 - 修复发现的小问题
[3] 📋 仅记录 - 不修改，只保存评估报告
```

认证标签格式（添加到 CLAUDE.md 末尾）：

```markdown
---
<!-- Claude Code Optimizer 审查记录 -->
<!--
  评估时间: 2024-12-23
  评估版本: 1.0.1
  综合评分: 85/100
  评级: ⭐⭐⭐⭐ 优秀
  状态: ✅ 已认证
  下次审查: 当项目有重大变更时运行 /project-optimizer:evolve
-->
```

#### 评分 60-79：优化模式

```
⚠️ CLAUDE.md 可以优化

发现的问题：
1. ✗ 缺少目录结构说明
2. ✗ 无版本号和更新时间
3. ⚠ 代码规范章节过长

建议操作：
[1] 🔧 智能优化 - 自动修复上述问题，保留原有内容
[2] 📝 手动优化 - 显示具体建议，由你决定修改
[3] 📋 仅记录 - 不修改，保存评估报告待后续处理
```

#### 评分 < 60：完善模式

```
❌ CLAUDE.md 需要完善

主要问题：
1. ✗ 缺少关键章节 (技术栈、命令说明)
2. ✗ 内容过于简略 (仅 30 行)
3. ✗ 无结构化格式

建议操作：
[1] 🔄 重构完善 - 保留有价值内容，补充完整结构
[2] 📝 逐步完善 - 一步步引导补充内容
[3] 🆕 重新创建 - 备份现有文件，创建新配置
```

---

## 审查标签系统

### 标签含义

| 标签 | 含义 | 下次行为 |
|------|------|----------|
| `✅ 已认证` | 质量良好，无需修改 | 跳过评估，直接使用 |
| `🔧 待优化` | 有小问题，建议修复 | 提醒优化 |
| `⚠️ 需完善` | 问题较多，需要完善 | 提示处理 |
| `📅 过期` | 超过 30 天未更新 | 建议重新评估 |

### 识别已审查的项目

下次运行 `/project-optimizer:init` 时：

```
🔍 检测到已审查的 CLAUDE.md

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 上次审查信息：
   时间: 2024-12-20
   评分: 85/100
   状态: ✅ 已认证

📊 变更检测：
   CLAUDE.md 自上次审查后未修改

建议操作：
[1] ⏭️ 跳过 - 配置仍然有效
[2] 🔄 重新评估 - 项目有重大变更，需要更新
[3] 📊 查看报告 - 查看上次评估详情
```

---

## 完整处理逻辑

```
┌─────────────────────────────────────────┐
│              /init 开始                  │
└───────────────┬─────────────────────────┘
                │
                ▼
        ┌───────────────┐
        │ 存在 CLAUDE.md?│
        └───────┬───────┘
                │
       ┌────────┴────────┐
       │                 │
       ▼                 ▼
      否                 是
       │                 │
       ▼                 ▼
┌─────────────┐   ┌─────────────┐
│ 询问项目类型 │   │ 检查审查标签 │
└──────┬──────┘   └──────┬──────┘
       │                 │
       ▼          ┌──────┴──────┐
┌─────────────┐   │             │
│ 创建新配置   │   ▼             ▼
└──────┬──────┘ 有标签        无标签
       │          │             │
       │          ▼             ▼
       │   ┌─────────────┐ ┌─────────────┐
       │   │ 检查是否过期 │ │  质量评估   │
       │   └──────┬──────┘ └──────┬──────┘
       │          │               │
       │   ┌──────┴──────┐        │
       │   ▼             ▼        │
       │ 未过期        已过期      │
       │   │             │        │
       │   ▼             ▼        │
       │ ┌─────────┐  ┌─────────┐ │
       │ │跳过/查看│  │重新评估 │←┘
       │ └─────────┘  └────┬────┘
       │                   │
       │            ┌──────┴──────┐
       │            │   评分判断   │
       │            └──────┬──────┘
       │         ┌─────────┼─────────┐
       │         ▼         ▼         ▼
       │      >=80      60-79      <60
       │         │         │         │
       │         ▼         ▼         ▼
       │   ┌─────────┐┌─────────┐┌─────────┐
       │   │认证模式 ││优化模式 ││完善模式 │
       │   └────┬────┘└────┬────┘└────┬────┘
       │        │          │          │
       └────────┴──────────┴──────────┘
                      │
                      ▼
              ┌─────────────┐
              │ 安装命令/设置│
              └─────────────┘
                      │
                      ▼
              ┌─────────────┐
              │  完成输出    │
              └─────────────┘
```

---

## 输出示例

### 新项目初始化

```
✅ 项目初始化完成！

📁 创建的文件：
   ✓ CLAUDE.md (开发中项目模板)
   ✓ .claude/settings.json (权限配置)
   ✓ .claude/commands/ (4 个命令)
   ✓ docs/DISCOVERIES.md (发现记录)

🎯 下一步：
   1. 编辑 CLAUDE.md 填写项目信息
   2. 运行 /project-optimizer:status 查看状态
   3. 使用 /project-optimizer:plan 开始任务规划

💡 提示：
   CLAUDE.md 会随项目演进自动更新
   运行 /project-optimizer:evolve 手动触发更新
```

### 现有项目认证

```
✅ CLAUDE.md 已认证！

📊 评估结果：85/100 ⭐⭐⭐⭐ 优秀

🏷️ 已添加审查标签，下次初始化将识别此配置

📁 安装的功能：
   ✓ .claude/commands/ (4 个命令)
   ✓ .claude/settings.json (权限配置)

💡 提示：
   使用 /project-optimizer:evolve 持续优化 CLAUDE.md
   使用 /project-optimizer:sync 保持配置与代码同步
```

### 现有项目优化

```
🔧 CLAUDE.md 已优化！

📊 优化前: 72/100 → 优化后: 88/100

📝 修改内容：
   + 添加: 版本号和更新时间
   + 添加: 目录结构说明
   ~ 精简: 代码规范章节 (60行→35行)
   + 添加: 审查标签

💾 备份：
   原文件已备份: .claude/backups/CLAUDE.md.bak.20241223

🎯 下一步：
   查看修改: cat CLAUDE.md
   恢复备份: /project-optimizer:restore --claude
```
