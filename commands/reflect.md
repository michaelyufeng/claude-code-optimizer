---
description: Long-term memory - archive and organize short-term memory
---

# 长期记忆 (Reflect)

整理短期记忆到长期存储，永久保存项目历史。

## 自动驾驶行为

自动驾驶模式下，reflect 会在以下时机自动触发：

- Memory 容量达到 10 条
- 阶段结束时
- Git commit 前
- 项目完成时

---

## 长期记忆存储

### 文件位置

```
docs/HISTORY.md
```

### 文件格式

```markdown
# 项目历史 (Project History)

> 自动生成，记录项目演进历程

## 2024-12-23 - 架构阶段

### 关键决策
- 选择单体架构，原因: MVP 阶段优先简单
- 使用 JWT 认证，原因: 无状态、可扩展
- 数据库选择 PostgreSQL，原因: 关系型数据、成熟稳定

### 完成事项
- API 设计完成 (15 个端点)
- 数据模型设计完成 (5 个表)
- 项目结构确定

### 问题与解决
- 问题: API 版本管理
  解决: 使用 URL 前缀 /api/v1/

### 产出文档
- docs/ARCHITECTURE.md

---

## 2024-12-22 - 规划阶段

### 关键决策
- MVP 包含 4 个核心功能
- 优先级: 用户系统 > 核心功能 > 增强功能

### 完成事项
- PRD 文档编写
- 用户故事定义
- 功能优先级排序

### 产出文档
- docs/PRD.md

---

## 2024-12-21 - 研究阶段

### 关键决策
- 技术栈: TypeScript + Hono + Drizzle
- 部署: Cloudflare Workers

### 完成事项
- 需求分析
- 技术选型
- 可行性评估

---

*由 /reflect 自动生成*
```

---

## 整理流程

### 自动整理

```
🔄 整理短期记忆到长期记忆

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## 待整理记录 (5 条)

1. 2024-12-23 16:00 - 决定使用 JWT 认证
2. 2024-12-23 15:30 - 架构阶段完成
3. 2024-12-23 15:00 - API 设计完成
4. 2024-12-23 14:30 - 数据模型设计
5. 2024-12-23 14:00 - 选择单体架构

## 整理方式

按阶段分组，提取:
- 关键决策
- 完成事项
- 问题与解决
- 产出文档

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

正在整理...

✅ 已追加到 docs/HISTORY.md
✅ 已清理 Memory 中的旧记录

Memory: 5/10 → 0/10

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 手动整理

```bash
/project-optimizer:reflect              # 整理所有短期记忆
/project-optimizer:reflect --preview    # 预览整理结果
/project-optimizer:reflect --phase      # 只整理当前阶段
```

---

## 整理规则

### 提取关键信息

```markdown
## 从短期记忆提取

1. **关键决策**
   - 包含 "决策"、"选择"、"决定" 的记录
   - 提取决策内容和原因

2. **完成事项**
   - 包含 "完成" 的记录
   - 提取完成的具体内容

3. **问题与解决**
   - 包含 "问题"、"发现"、"解决" 的记录
   - 成对提取问题和解决方案

4. **产出文档**
   - 包含 "产出"、"生成" 的记录
   - 提取文件路径
```

### 分组规则

```markdown
## 按时间和阶段分组

- 同一天的记录归入同一组
- 标注所属阶段
- 按时间倒序排列（最新在前）
```

---

## 查看长期记忆

```
/project-optimizer:reflect --show

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📚 长期记忆 (docs/HISTORY.md)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## 统计

- 记录天数: 3 天
- 阶段数: 3 个
- 关键决策: 8 个
- 完成事项: 15 个
- 问题解决: 3 个

## 最近记录

### 2024-12-23 - 架构阶段
- 选择单体架构
- API 设计完成
- 数据模型设计完成

### 2024-12-22 - 规划阶段
- MVP 范围确定
- PRD 完成

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[1] 📖 查看完整历史
[2] 🔍 搜索历史
[3] 📊 查看统计
```

---

## 双记忆系统总结

```
┌──────────────────────────────────────────────────────┐
│                   🧠 双记忆系统                        │
├──────────────────────────────────────────────────────┤
│                                                       │
│  ┌─────────────────┐       ┌─────────────────┐       │
│  │   短期记忆       │       │   长期记忆       │       │
│  │   (Memory)      │ ────▶ │   (History)     │       │
│  │                 │reflect│                 │       │
│  │  CLAUDE.md      │       │  docs/HISTORY.md │       │
│  │  ## Memory      │       │                 │       │
│  │                 │       │                 │       │
│  │  最多 10 条     │       │  永久保存       │       │
│  │  当前会话可见   │       │  跨会话持久     │       │
│  │  实时更新       │       │  按阶段分组     │       │
│  └─────────────────┘       └─────────────────┘       │
│           │                         │                │
│           └─────────┬───────────────┘                │
│                     │                                │
│                     ▼                                │
│           ┌─────────────────┐                        │
│           │   新会话启动     │                        │
│           │                 │                        │
│           │  1. 读取 CLAUDE.md (短期)                │
│           │  2. 读取 HISTORY.md (长期)               │
│           │  3. 恢复项目上下文                        │
│           └─────────────────┘                        │
│                                                       │
└──────────────────────────────────────────────────────┘
```
