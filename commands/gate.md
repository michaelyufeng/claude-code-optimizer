---
description: Gate check - phase quality control before proceeding
---

# Gate 门控系统

阶段质量检查，必须通过才能进入下一阶段。

## 概览

6 阶段流程中有 3 道 Gate：

```
研究 → 规划 → [Gate 1] → 架构 → 开发 → [Gate 2] → 测试 → [Gate 3] → 部署
```

| Gate | 位置 | 检查重点 |
|------|------|----------|
| Gate 1 | 规划→架构 | PRD 完整性、需求可行性 |
| Gate 2 | 开发→测试 | 代码质量、功能完整性 |
| Gate 3 | 测试→部署 | 测试覆盖率、安全审计 |

---

## Gate 检查命令

```bash
/project-optimizer:gate           # 检查当前阶段对应的 Gate
/project-optimizer:gate --all     # 检查所有 Gate 状态
/project-optimizer:gate --fix     # 检查并自动修复
/project-optimizer:gate 1         # 检查 Gate 1
/project-optimizer:gate 2         # 检查 Gate 2
/project-optimizer:gate 3         # 检查 Gate 3
```

---

## Gate 1: 规划阶段 → 架构阶段

### 检查时机
规划阶段完成后，进入架构阶段前。

### 检查清单

```
🚧 Gate 1 检查

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## PRD 完整性 (必须全部 ✅)

[ ] docs/PRD.md 存在
    - 文件已创建

[ ] 产品概述完整
    - 产品名称和描述
    - 核心价值主张
    - 目标用户定义

[ ] 用户故事完整
    - 用户故事列表
    - 优先级标注 (P0/P1/P2)
    - 验收标准

[ ] MVP 范围明确
    - 包含功能列表
    - 排除功能列表
    - 边界清晰

## 技术可行性 (必须全部 ✅)

[ ] 技术方案可行
    - 技术栈已确定
    - 无明显技术障碍
    - 团队能力匹配

[ ] 依赖项清晰
    - 第三方依赖列表
    - 外部服务依赖
    - 风险已评估

## 文档同步 (必须全部 ✅)

[ ] CLAUDE.md 已更新
    - 项目概述
    - 技术栈
    - 核心功能

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

结果: [✅ 通过 / ❌ 不通过]
```

### 通过条件
- 所有检查项必须通过
- docs/PRD.md 必须存在且内容完整
- CLAUDE.md 必须包含必要章节

---

## Gate 2: 开发阶段 → 测试阶段

### 检查时机
开发阶段完成后，进入测试阶段前。

### 检查清单

```
🚧 Gate 2 检查

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## 代码质量 (必须全部 ✅)

[ ] 核心功能已实现
    - P0 功能全部完成
    - P1 功能基本完成
    - 代码可运行

[ ] 代码规范通过
    - Lint 检查通过
    - 格式化规范
    - 无严重警告

[ ] 无遗留问题
    - 无 TODO/FIXME 遗留
    - 无已知阻塞性 Bug
    - 依赖版本锁定

## 基础测试 (必须全部 ✅)

[ ] 基本单元测试存在
    - 核心模块有测试
    - 测试可运行
    - 覆盖率 > 50%

[ ] 代码可审查
    - 代码结构清晰
    - 关键逻辑有注释
    - 提交历史清晰

## 文档同步 (必须全部 ✅)

[ ] 技术文档更新
    - docs/ARCHITECTURE.md 更新
    - docs/API.md 更新（如适用）
    - README.md 更新

[ ] CLAUDE.md 已更新
    - 开发进度
    - 已实现功能
    - 技术决策记录

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

结果: [✅ 通过 / ❌ 不通过]
```

### 通过条件
- 核心功能必须实现
- 代码必须通过 Lint 检查
- 必须有基本的单元测试

---

## Gate 3: 测试阶段 → 部署阶段

### 检查时机
测试阶段完成后，进入部署阶段前。

### 检查清单

```
🚧 Gate 3 检查

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## 测试覆盖 (必须全部 ✅)

[ ] 测试覆盖率达标
    - 代码覆盖率 ≥ 80%
    - 核心模块覆盖率 ≥ 90%
    - 测试报告已生成

[ ] 测试全部通过
    - 单元测试 100% 通过
    - 集成测试 100% 通过
    - E2E 测试 ≥ 95% 通过

[ ] 无 P0/P1 Bug
    - 无阻塞性 Bug
    - 无高优先级 Bug
    - Bug 列表已清理

## 安全审计 (必须全部 ✅)

[ ] 安全扫描通过
    - 依赖安全检查
    - 代码安全扫描
    - 无已知漏洞

[ ] 敏感信息安全
    - 无硬编码密钥
    - 环境变量配置正确
    - .env 文件未提交

## 发布准备 (必须全部 ✅)

[ ] 版本信息更新
    - 版本号更新
    - CHANGELOG.md 更新
    - 发布说明准备

[ ] 文档完善
    - README.md 完整
    - 部署文档完整
    - API 文档完整

[ ] 部署配置就绪
    - 环境变量模板
    - 部署脚本/配置
    - CI/CD 配置

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

结果: [✅ 通过 / ❌ 不通过]
```

### 通过条件
- 测试覆盖率必须 ≥ 80%
- 所有测试必须通过
- 安全扫描必须通过
- 无 P0/P1 Bug

---

## Gate 检查流程

### 1. 自动触发

Gate 检查由自动驾驶系统在阶段结束时自动触发：

```
阶段完成 → 自动检查 Gate → 通过 → 进入下一阶段
                         → 失败 → 显示问题 → 修复 → 重检
```

### 2. 检查结果

**通过示例：**

```
🚧 Gate 1 检查结果

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## 检查项状态

✅ PRD 完整性
   ✅ docs/PRD.md 存在
   ✅ 产品概述完整
   ✅ 用户故事完整
   ✅ MVP 范围明确

✅ 技术可行性
   ✅ 技术方案可行
   ✅ 依赖项清晰

✅ 文档同步
   ✅ CLAUDE.md 已更新

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

结果: ✅ 通过！

正在进入架构阶段...
```

**失败示例：**

```
🚧 Gate 2 检查结果

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## 检查项状态

✅ 代码质量
   ✅ 核心功能已实现
   ✅ 代码规范通过
   ❌ 无遗留问题
      → 发现 3 个 TODO 未处理

❌ 基础测试
   ❌ 基本单元测试存在
      → 覆盖率 35%，低于要求的 50%
   ✅ 代码可审查

✅ 文档同步
   ✅ 技术文档更新
   ✅ CLAUDE.md 已更新

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

结果: ❌ 不通过

## 需要修复

1. 处理遗留的 TODO (3 个)
   - src/auth/login.ts:45 - TODO: 添加验证
   - src/api/user.ts:23 - TODO: 错误处理
   - src/utils/format.ts:12 - FIXME: 性能优化

2. 提高测试覆盖率 (当前 35%，目标 50%)
   - 添加 src/auth/*.ts 的测试
   - 添加 src/api/*.ts 的测试

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[1] 🔧 自动修复（移除 TODO 注释）
[2] 📝 手动修复
[3] 🔄 重新检查
```

### 3. 修复后重检

```bash
/project-optimizer:gate  # 重新检查当前 Gate
```

---

## Gate 状态追踪

存储在 `.claude/PROJECT_STATE.json`:

```json
{
  "phases": {
    "research": {
      "status": "completed",
      "gate": null
    },
    "plan": {
      "status": "completed",
      "gate": {
        "name": "gate1",
        "passed": true,
        "checkedAt": "[timestamp]",
        "items": [
          { "name": "PRD 完整性", "passed": true },
          { "name": "技术可行性", "passed": true },
          { "name": "文档同步", "passed": true }
        ]
      }
    },
    "arch": {
      "status": "completed",
      "gate": null
    },
    "dev": {
      "status": "completed",
      "gate": {
        "name": "gate2",
        "passed": true,
        "checkedAt": "[timestamp]"
      }
    },
    "test": {
      "status": "completed",
      "gate": {
        "name": "gate3",
        "passed": true,
        "checkedAt": "[timestamp]"
      }
    },
    "deploy": {
      "status": "in_progress",
      "gate": null
    }
  }
}
```

---

## 注意事项

1. **不可跳过** - Gate 是强制检查点，必须通过才能进入下一阶段
2. **可重试** - Gate 失败后可以修复并重新检查
3. **自动触发** - 阶段完成时自动触发 Gate 检查
4. **手动触发** - 也可以使用 `/gate` 命令手动检查
5. **记录追踪** - Gate 检查结果会记录在 PROJECT_STATE.json 中
