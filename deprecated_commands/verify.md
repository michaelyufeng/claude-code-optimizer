---
description: Verify production fix before deployment
---

# 验证修复 (运维项目 - Phase 4/5)

## 前置检查

确认修复阶段 (`fix`) 已完成。

## 验证流程

### 🧪 1. 自动化测试

```markdown
## 自动化测试

### 单元测试
```bash
npm run test
```
结果: ✅ 通过 / ❌ 失败

### 集成测试
```bash
npm run test:integration
```
结果: ✅ 通过 / ❌ 失败

### 相关测试覆盖
```bash
npm run test:coverage -- [modified files]
```
覆盖率: X%

### 回归测试
```bash
npm run test:regression
```
结果: ✅ 通过 / ❌ 失败
```

### 🔄 2. 问题复现测试

```markdown
## 复现测试

### 修复前行为（回顾）
[问题描述]

### 修复后测试
按照原始复现步骤测试:

1. [步骤1] → 结果: ___
2. [步骤2] → 结果: ___
3. [步骤3] → 结果: ___

### 验证结果
- [ ] 问题不再复现
- [ ] 行为符合期望
- [ ] 无新问题引入
```

### 🔍 3. 边界情况测试

```markdown
## 边界情况测试

### 测试场景
| 场景 | 输入 | 期望结果 | 实际结果 | 通过 |
|------|------|----------|----------|------|
| 正常情况 | | | | ⬜ |
| 空值 | | | | ⬜ |
| 边界值 | | | | ⬜ |
| 异常值 | | | | ⬜ |
| 并发 | | | | ⬜ |

### 错误处理测试
| 错误场景 | 期望处理 | 实际处理 | 通过 |
|----------|----------|----------|------|
| | | | ⬜ |
```

### 🔒 4. 安全检查

```markdown
## 安全检查

### 自动扫描
```bash
npm audit
# 或
snyk test
```
结果: ✅ 无新漏洞 / ⚠️ 发现问题

### 手动检查
- [ ] 无敏感信息泄露
- [ ] 无 SQL 注入风险
- [ ] 无 XSS 风险
- [ ] 权限检查正常
```

### 📊 5. 性能检查

```markdown
## 性能检查

### 修改前后对比
| 指标 | 修改前 | 修改后 | 变化 |
|------|--------|--------|------|
| 响应时间 | | | |
| 内存使用 | | | |
| CPU 使用 | | | |

### 结论
- [ ] 性能无明显下降
- [ ] 无内存泄漏
- [ ] 无性能瓶颈引入
```

### ✅ 6. 验收确认

```markdown
## 验收清单

### 功能验收
- [ ] 问题已修复
- [ ] 原有功能正常
- [ ] 无副作用

### 质量验收
- [ ] 所有测试通过
- [ ] 代码质量合格
- [ ] 无安全问题

### 运维验收
- [ ] 日志输出正常
- [ ] 监控指标正常
- [ ] 告警配置正常
```

---

## 验证结果

### 验证通过

```json
{
  "phases": {
    "verify": {
      "status": "completed",
      "completedAt": "[timestamp]",
      "result": "passed",
      "testResults": {
        "unit": "passed",
        "integration": "passed",
        "regression": "passed"
      }
    },
    "output": { "status": "in_progress" }
  }
}
```

输出：
```
✅ 验证通过！

📋 验证摘要：
- 单元测试: ✅ 通过
- 集成测试: ✅ 通过
- 回归测试: ✅ 通过
- 问题复现: ✅ 已修复
- 安全检查: ✅ 通过
- 性能检查: ✅ 通过

🎉 修复已验证，可以准备部署！

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🚀 运维项目流程:
✓ 诊断 → ✓ 审批 → ✓ 修复 → ✓ 验证 → 📦 输出
                                     ↑
                                   最后一步
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

下一步：运行 /project-optimizer:output 生成变更报告
```

### 验证失败

```json
{
  "phases": {
    "verify": {
      "status": "failed",
      "failedAt": "[timestamp]",
      "failReason": "[原因]"
    },
    "fix": { "status": "in_progress" }
  }
}
```

输出：
```
❌ 验证失败！

失败原因:
- [失败项1]: [详情]
- [失败项2]: [详情]

建议操作:
1. 检查修复代码
2. 分析失败原因
3. 修正问题后重新验证

⚠️ 请勿部署未验证通过的代码！

运行 /project-optimizer:fix 返回修复阶段
```
